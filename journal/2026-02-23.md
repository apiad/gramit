# Journal - 2026-02-23

- Retroactively documented the completion of Phase 1 (Project Scaffolding) which was done in a previous session.
- Marked all Phase 1 tasks in `ROADMAP.md` as complete.
- Updated `CHANGELOG.md` under the `[Unreleased]` section to reflect the initial project setup.
- This brings the project documentation in sync with the actual state of the repository.

### Phase 1 Implementation Details

- **Project Initialization**: The project was initialized using `uv`, creating the virtual environment and `pyproject.toml`.
- **Directory Structure**: Created `src/gramit` for the main application source and `tests/` for testing.
- **Dependencies Added**:
    - Main dependencies (`uv add`): `pyte>=0.8.2`, `python-dotenv>=1.2.1`, `python-telegram-bot>=22.6`.
    - Development dependencies (`uv add --dev`): `pytest>=9.0.2`, `pytest-asyncio>=1.3.0`.
- **Core Files Created**: The initial set of empty Python modules were created in `src/gramit/`:
    - `__init__.py`
    - `cli.py`
    - `filters.py`
    - `orchestrator.py`
    - `router.py`
    - `telegram.py`
- **Test Configuration**: Configured `pytest` in `pyproject.toml` to use `tests` as the test path and set `asyncio_mode` to `auto`.

---

## Phase 2: PTY Orchestrator

- **TDD Setup**: Began Phase 2 by writing a failing test (`test_orchestrator_spawns_process`) in a new file, `tests/test_orchestrator.py`.
- **Configuration**: Updated `pyproject.toml` to include the `src` directory in `pytest`'s `pythonpath` to enable module discovery. Encountered and fixed syntax errors with `[tool.uv.sources]`.
- **Implementation**: Wrote the initial `Orchestrator` class in `src/gramit/orchestrator.py`. Implemented the `__init__`, `start`, `is_alive`, and `shutdown` methods using `os.forkpty()` to manage a child process.
- **Testing**: Successfully passed the initial test, confirming that the orchestrator can spawn and terminate a process.
- **Commit**: Committed the initial implementation and test as `feat(orchestrator): Implement basic PTY process spawning`.

---

- **I/O Implementation**: Added `read` and `write` methods to the `Orchestrator` to enable two-way communication.
- **TDD for I/O**: Created tests for both `read` and `write` methods, ensuring they failed before implementation and passed after.
- **Phase Completion**: All core `Orchestrator` functionality is now implemented and tested.
- **Commit**: Committed the I/O methods as `feat(orchestrator): Implement read and write methods`.

---

## Phase 3: Output Router (Line Mode)

- **TDD for Debouncer**: Started Phase 3 by creating `tests/test_debouncer.py` and writing a failing test for a new `AsyncDebouncer` class.
- **Debouncer Implementation**: Created `src/gramit/debouncer.py` and implemented the `AsyncDebouncer` to collect and flush items after a set interval.
- **Testing**: Confirmed the implementation works by passing the test.
- **Commit**: Committed the new utility as `feat(common): Add AsyncDebouncer utility`.
